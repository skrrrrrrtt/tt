--!strict
-- Kohana Volcano Teleport + Equip Rod + LegitFishing (no UI)

local Players           = game:GetService("Players")
local RunService       = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Player   = Players.LocalPlayer
local Character, Humanoid

----------------------------------------------------------------
-- 1. Wait for character + teleport
----------------------------------------------------------------
local function waitForCharacter()
    if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
        Character = Player.Character
        Humanoid  = Character:FindFirstChildOfClass("Humanoid")
        return
    end
    Player.CharacterAdded:Wait()
    Character = Player.Character
    Humanoid  = Character:WaitForChild("Humanoid")
end

waitForCharacter()

-- Teleport to Kohana Volcano
local volcanoCFrame = CFrame.new(
    -628.758911, 35.710186, 104.373764,
    0.482912123, 1.81591773e-08, 0.875668824,
    3.01732896e-08, 1, -3.73774007e-08,
    -0.875668824, 4.44718076e-08, 0.482912123
)

Character:WaitForChild("HumanoidRootPart").CFrame = volcanoCFrame
print("Teleported to Kohana Volcano")

----------------------------------------------------------------
-- 2. Equip rod from hotbar (change slot if needed)
----------------------------------------------------------------
task.delay(0.5, function()  -- tiny delay so the character fully loads
    local Net = ReplicatedStorage
        :WaitForChild("Packages")
        :WaitForChild("_Index")
        :WaitForChild("sleitnick_net@0.2.0")
        :WaitForChild("net")

    local REEquipToolFromHotbar = Net:WaitForChild("RE/EquipToolFromHotbar")

    pcall(function()
        REEquipToolFromHotbar:FireServer(1)
    end)
    print("Rod equipped from hotbar slot 1")
end)

----------------------------------------------------------------
-- 3. LegitFishing automation (your original code, unchanged)
----------------------------------------------------------------
task.spawn(function()
    repeat task.wait() until game:IsLoaded()

    local Net = ReplicatedStorage
        :WaitForChild("Packages")
        :WaitForChild("_Index")
        :WaitForChild("sleitnick_net@0.2.0")
        :WaitForChild("net")

    local RfCancel = Net:WaitForChild("RF/CancelFishingInputs")
    local FishingController = require(ReplicatedStorage.Controllers.FishingController)
    local Constants = require(ReplicatedStorage.Shared.Constants)

    Constants.FishingCooldownTime = 0

    local States = {
        Idle      = "Idle",
        Casting   = "Casting",
        Waiting   = "Waiting",
        Minigame  = "Minigame",
        Reeling   = "Reeling",
        Completed = "Completed",
    }

    local CurrentState = States.Idle
    local CurrentGuid  = nil
    local MinigameCompleted = false
    local StateChangeTime = os.clock()

    local function DetectState()
        local Guid = FishingController:GetCurrentGUID()
        if Guid then
            if CurrentState ~= States.Minigame then
                CurrentGuid = Guid
                MinigameCompleted = false
            end
            return States.Minigame
        end

        if CurrentGuid and not Guid then
            local IsBusy = (FishingController.FishingLine and FishingController.FishingLine.Parent)
                or (FishingController.FishingBobber and FishingController.FishingBobber.Parent)
                or FishingController._isFishing
                or FishingController._isReeling

            if IsBusy then
                return States.Reeling
            else
                if MinigameCompleted then
                    return States.Completed
                else
                    CurrentGuid = nil
                    return States.Idle
                end
            end
        end

        return (FishingController.OnCooldown and FishingController:OnCooldown() or false)
            and States.Waiting or States.Idle
    end

    while true do
        if not (Character and Character:FindFirstChild("HumanoidRootPart")) then
            task.wait(1)
            continue
        end

        local NewState = DetectState()
        if NewState ~= CurrentState then
            CurrentState = NewState
            StateChangeTime = os.clock()
        end

        if (CurrentState == States.Casting or CurrentState == States.Waiting)
            and (os.clock() - StateChangeTime) > 8 then
            pcall(RfCancel.InvokeServer, RfCancel)
            CurrentState = States.Idle
            StateChangeTime = os.clock()
        end

        if CurrentState == States.Idle then
            if not FishingController:OnCooldown() then
                pcall(RfCancel.InvokeServer, RfCancel)
                pcall(FishingController.RequestChargeFishingRod, FishingController, nil, true)
                CurrentState = States.Casting
            end
        end

        if CurrentState == States.Minigame then
            local ClickConnection
            ClickConnection = RunService.Heartbeat:Connect(function()
                if not FishingController:GetCurrentGUID() then
                    if ClickConnection then ClickConnection:Disconnect() end
                    return
                end
                for i = 1, 5 do
                    pcall(FishingController.FishingMinigameClick, FishingController)
                end
            end)

            while FishingController:GetCurrentGUID() do task.wait() end
            if ClickConnection then ClickConnection:Disconnect() end

            MinigameCompleted = true
            CurrentState = States.Completed
        end

        if CurrentState == States.Completed then
            CurrentGuid = nil
            MinigameCompleted = false
            CurrentState = States.Idle
        end

        task.wait()
    end
end)

print("LegitFishing loaded â€“ running silently.")

----------------------------------------------------------------
-- 4. FISH RARITY TRACKER UI
----------------------------------------------------------------

local PlayerGui = Players.LocalPlayer:WaitForChild("PlayerGui")

local TrackerGui = Instance.new("ScreenGui")
TrackerGui.Name = "FishRarityTracker"
TrackerGui.ResetOnSpawn = false
TrackerGui.Parent = PlayerGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 220, 0, 230)
Frame.Position = UDim2.new(0.02, 0, 0.25, 0)
Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Frame.BorderSizePixel = 0
Frame.BackgroundTransparency = 0.35
Frame.Parent = TrackerGui

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, 0, 0, 30)
Title.BackgroundTransparency = 1
Title.Text = "ðŸŽ£ Fish Tracker"
Title.Font = Enum.Font.GothamBold
Title.TextSize = 20
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Parent = Frame

local Rarities = {
    {"Common",     Color3.fromRGB(180,180,180)},
    {"Uncommon",   Color3.fromRGB(80,255,80)},
    {"Rare",       Color3.fromRGB(70,140,255)},
    {"Epic",       Color3.fromRGB(170,70,255)},
    {"Legendary",  Color3.fromRGB(255,170,0)},
    {"Mythic",     Color3.fromRGB(255,70,70)},
    {"SECRET",     Color3.fromRGB(255,255,0)},
}

local Counters = {}

for i, data in ipairs(Rarities) do
    local rarityName, color = data[1], data[2]

    local Label = Instance.new("TextLabel")
    Label.Size = UDim2.new(1, -10, 0, 25)
    Label.Position = UDim2.new(0, 5, 0, 30 + (i * 27))
    Label.BackgroundTransparency = 1
    Label.Font = Enum.Font.Gotham
    Label.TextSize = 18
    Label.TextXAlignment = Enum.TextXAlignment.Left
    Label.TextColor3 = color
    Label.Text = rarityName .. ": 0"
    Label.Parent = Frame

    Counters[rarityName] = {Count = 0, Label = Label}
end

----------------------------------------------------------------
-- 5. LISTEN TO FISH CAUGHT EVENT (FROM YOUR GAME)
----------------------------------------------------------------

local Net = ReplicatedStorage
    :WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")

local REFishCaught = Net:WaitForChild("RE/FishCaught")

REFishCaught.OnClientEvent:Connect(function(fishName, fishData)
    if not fishData then return end

    local rarity = fishData.Rarity or fishData.rarity
    if not rarity then return end

    rarity = string.upper(rarity)

    for rarityName, data in pairs(Counters) do
        if string.upper(rarityName) == rarity then
            data.Count += 1
            data.Label.Text = rarityName .. ": " .. data.Count
        end
    end
end)

print("Fish rarity tracker loaded.")
