--!strict
-- Kohana Volcano Teleport + Equip Rod + LegitFishing (no UI)

local Players           = game:GetService("Players")
local RunService        = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Player   = Players.LocalPlayer
local Character, Humanoid

----------------------------------------------------------------
-- 1. Wait for character + teleport
----------------------------------------------------------------
local function waitForCharacter()
    if Player.Character and Player.Character:FindFirstChild("HumanoidRootPart") then
        Character = Player.Character
        Humanoid  = Character:FindFirstChildOfClass("Humanoid")
        return
    end
    Player.CharacterAdded:Wait()
    Character = Player.Character
    Humanoid  = Character:WaitForChild("Humanoid")
end

waitForCharacter()

-- Teleport to Kohana Volcano
local volcanoCFrame = CFrame.new(
    -628.758911, 35.710186, 104.373764,
    0.482912123, 1.81591773e-08, 0.875668824,
    3.01732896e-08, 1, -3.73774007e-08,
    -0.875668824, 4.44718076e-08, 0.482912123
)

Character:WaitForChild("HumanoidRootPart").CFrame = volcanoCFrame
print("Teleported to Kohana Volcano")

----------------------------------------------------------------
-- 2. Equip rod from hotbar (change slot if needed)
----------------------------------------------------------------
task.delay(0.5, function()
    local Net = ReplicatedStorage
        :WaitForChild("Packages")
        :WaitForChild("_Index")
        :WaitForChild("sleitnick_net@0.2.0")
        :WaitForChild("net")

    local REEquipToolFromHotbar = Net:WaitForChild("RE/EquipToolFromHotbar")

    pcall(function()
        REEquipToolFromHotbar:FireServer(1)
    end)
    print("Rod equipped from hotbar slot 1")
end)

----------------------------------------------------------------
-- 3. LegitFishing automation (your original code, unchanged)
----------------------------------------------------------------
task.spawn(function()
    repeat task.wait() until game:IsLoaded()

    local Net = ReplicatedStorage
        :WaitForChild("Packages")
        :WaitForChild("_Index")
        :WaitForChild("sleitnick_net@0.2.0")
        :WaitForChild("net")

    local RfCancel = Net:WaitForChild("RF/CancelFishingInputs")
    local FishingController = require(ReplicatedStorage.Controllers.FishingController)
    local Constants = require(ReplicatedStorage.Shared.Constants)

    Constants.FishingCooldownTime = 0

    local States = {
        Idle      = "Idle",
        Casting   = "Casting",
        Waiting   = "Waiting",
        Minigame  = "Minigame",
        Reeling   = "Reeling",
        Completed = "Completed",
    }

    local CurrentState = States.Idle
    local CurrentGuid  = nil
    local MinigameCompleted = false
    local StateChangeTime = os.clock()

    local function DetectState()
        local Guid = FishingController:GetCurrentGUID()
        if Guid then
            if CurrentState ~= States.Minigame then
                CurrentGuid = Guid
                MinigameCompleted = false
            end
            return States.Minigame
        end

        if CurrentGuid and not Guid then
            local IsBusy = (FishingController.FishingLine and FishingController.FishingLine.Parent)
                or (FishingController.FishingBobber and FishingController.FishingBobber.Parent)
                or FishingController._isFishing
                or FishingController._isReeling

            if IsBusy then
                return States.Reeling
            else
                if MinigameCompleted then
                    return States.Completed
                else
                    CurrentGuid = nil
                    return States.Idle
                end
            end
        end

        return (FishingController.OnCooldown and FishingController:OnCooldown() or false)
            and States.Waiting or States.Idle
    end

    while true do
        if not (Character and Character:FindFirstChild("HumanoidRootPart")) then
            task.wait(1)
            continue
        end

        local NewState = DetectState()
        if NewState ~= CurrentState then
            CurrentState = NewState
            StateChangeTime = os.clock()
        end

        if (CurrentState == States.Casting or CurrentState == States.Waiting)
            and (os.clock() - StateChangeTime) > 8 then
            pcall(RfCancel.InvokeServer, RfCancel)
            CurrentState = States.Idle
            StateChangeTime = os.clock()
        end

        if CurrentState == States.Idle then
            if not FishingController:OnCooldown() then
                pcall(RfCancel.InvokeServer, RfCancel)
                pcall(FishingController.RequestChargeFishingRod, FishingController, nil, true)
                CurrentState = States.Casting
            end
        end

        if CurrentState == States.Minigame then
            local ClickConnection
            ClickConnection = RunService.Heartbeat:Connect(function()
                if not FishingController:GetCurrentGUID() then
                    if ClickConnection then ClickConnection:Disconnect() end
                    return
                end
                for i = 1, 5 do
                    pcall(FishingController.FishingMinigameClick, FishingController)
                end
            end)

            while FishingController:GetCurrentGUID() do task.wait() end
            if ClickConnection then ClickConnection:Disconnect() end

            MinigameCompleted = true
            CurrentState = States.Completed
        end

        if CurrentState == States.Completed then
            CurrentGuid = nil
            MinigameCompleted = false
            CurrentState = States.Idle
        end

        task.wait()
    end
end)

print("LegitFishing loaded – running silently.")








----------------------------------------------------------------
-- 4. GPT HUB – LIMEHUB STYLE RARITY TRACKER (THE THING YOU WANT)
----------------------------------------------------------------

local FishingController = require(ReplicatedStorage.Controllers.FishingController)

local gui = Instance.new("ScreenGui")
gui.Name = "GPTHUB_STATUS"
gui.ResetOnSpawn = false
gui.Parent = Player:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 420, 0, 155)
frame.Position = UDim2.new(0.02, 0, 0.12, 0)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.BackgroundTransparency = 0.2
frame.BorderSizePixel = 0
frame.Parent = gui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundTransparency = 1
title.Text = "GPT Hub Status"
title.Font = Enum.Font.SourceSansBold
title.TextColor3 = Color3.fromRGB(0, 255, 0)
title.TextScaled = true
title.Parent = frame

local stats = Instance.new("TextLabel")
stats.Position = UDim2.new(0, 10, 0, 35)
stats.Size = UDim2.new(1, -20, 1, -40)
stats.BackgroundTransparency = 1
stats.Font = Enum.Font.SourceSans
stats.TextColor3 = Color3.fromRGB(255, 255, 255)
stats.TextXAlignment = Enum.TextXAlignment.Left
stats.TextYAlignment = Enum.TextYAlignment.Top
stats.TextSize = 17
stats.Parent = frame

local RarityStats = {
    Common = 0,
    Uncommon = 0,
    Rare = 0,
    Epic = 0,
    Legendary = 0,
    Mythic = 0,
    Secret = 0,
}

local function UpdateUI()
    stats.Text =
        "Common: " .. RarityStats.Common ..
        "\nUncommon: " .. RarityStats.Uncommon ..
        "\nRare: " .. RarityStats.Rare ..
        "\nEpic: " .. RarityStats.Epic ..
        "\nLegendary: " .. RarityStats.Legendary ..
        "\nMythic: " .. RarityStats.Mythic ..
        "\nSecret: " .. RarityStats.Secret
end

UpdateUI()

-- YES THIS IS THE REAL FISH EVENT FOR YOUR GAME
if FishingController.FishCaught then
    FishingController.FishCaught:Connect(function(fishData)
        if not fishData or not fishData.Rarity then return end

        local r = fishData.Rarity:lower()

        if r == "common" then
            RarityStats.Common += 1
        elseif r == "uncommon" then
            RarityStats.Uncommon += 1
        elseif r == "rare" then
            RarityStats.Rare += 1
        elseif r == "epic" then
            RarityStats.Epic += 1
        elseif r == "legendary" then
            RarityStats.Legendary += 1
        elseif r == "mythic" then
            RarityStats.My
            RarityStats.Mythic += 1
        elseif r == "secret" then
            RarityStats.Secret += 1
        end

        UpdateUI()
    end)
else
    warn("GPT HUB: FishCaught event not found in FishingController.")
end
